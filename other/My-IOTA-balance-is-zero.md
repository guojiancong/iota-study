原文：https://forum.helloiota.com/105/Help-My-IOTA-balance-is-zero-steps-to-help-you-find-your-balance
https://forum.helloiota.com/588/Help-My-IOTA-balance-is-zero-steps-to-help-you-find-your-balance-v254

# IOTA钱包是如何工作的？
和大多数人认为的不一样，IOTA钱包不存放IOTA币。相反，你的IOTA币安全的存放在Tangle中的一个或多个地址里。你可以把钱包当作一个能检索地址余额的浏览器。要做到这一点，它联系所谓的节点，并要求节点在分布式账簿数据库（实际上这就是Tangle）中查找一个地址的余额。为了获得总的余额，钱包通常检索属于你的多个地址的余额，然后加总，显示的结果就是你当前的余额。

这里有个重要的事情：一开始钱包不知道有多少地址以及哪些地址可以正确的检索并汇总你的余额。唯一的起点是你登录到钱包时提供的81个字符的种子。这个种子是钱包能确定性的生成可用地址的关键。确定性意味着给定相同的种子，它始终能够逐个生成完全相同的地址序列。要确定总的累计余额，钱包连续询问节点每个地址的余额，直到某个地址因为不存在Tangle中节点返回无法找到。对钱包来说这意味着这个地址之前没有生成或使用过，现在可以安全的停止累积地址余额了。这个事实很重要，因为我们很快可以用它来解释为什么你的余额目前是0。

钱包根据需要以两种重要的方式生成地址。首先，最常见的是，当你需要用钱包接收IOTA币时，你需要生成一个新的接收地址并将它附加到Tangle中。地址不应被重复使用，因为用于从地址支出资金的签名过程使用了一次签名算法。由于签名过程的一次性特点，每次从同一个地址支出资金会让地址上的公钥部分暴露进而容易遭到暴力攻击。任何拥有地址公钥的人都可以消费这个地址上的资金，因此将自己暴露在攻击中是很不明智的。这就是钱包在每次消费后将剩余的资金自动转入新的地址以抵御这种攻击的原因。

现在介绍钱包生成地址的第二种方式。当你指示钱包向某人的地址发送一定数量的IOTA币时，钱包做的事情是从头开始顺序浏览钱包中已知的地址序列，这个地址序列是由种子生成的。钱包累积其中非零余额的地址，直到累积的数量大于要发送的数量。以这种方式累积的非零地址的内容将作为单个传输发送到接收地址，并且（如果有余数），剩余部分将作为第二次传输发送到你钱包中新生成的地址。这将导致后一个地址被附加到Tangle中，这样新生成的地址就激活了，在任何时候钱包在扫描余额的过程中能够发现这个地址已经被使用。所有作为交易输入的地址在交易结束后余额都为0，因此它们不太可能被重复使用，除非你不小心犯错没有新建一个新的接收地址。

对于恢复过程来说，重要的是你能知道在“失去”余额前（快照前）使用了多少地址。对于大多数人最多可能使用了一二十个地址。但是那些经常使用钱包的人的地址数在快照发生前可能轻松到达上百个。我个人在帮助某人取回他的余额时，发现他的钱包使用了140个地址。

# 为什么我的余额是0？

要了解发生了什么，你需要知道当IOTA基金会生成IOTA分类账数据库的新快照时会发生什么。这是为了数据维护。上一次快照是在2017年9月22日星期五创建的。创建快照的一个原因是Tangle不断扩大，因此占用越来越多的内存。为了帮助节点限制数据库使用的内存量，通过删除历史交易来精简Tangle。请记住，在每次交易结束后，和交易相关的地址以后不再使用并且余额为0。这些交易只是占有空间，并且对节点的正常运行是不需要的。还有很多方式导致0余额交易的发生，例如钱包生成新的地址并附加到Tangle中。还有一些交易是用作系统之间的消息，不包含任何余额。

因此，在快照结束后，最终结果是包含非零余额地址及其余额的简单列表被保留在节点中，而产生这些余额的历史记录不被保留。顺便说一句，这个历史会保留在称为“perma-nodes”的节点，这个节点会保留能追溯到第一个交易的整个历史记录。对于大多数用例来说，交易的历史并不是必需的。只有非零余额的终端是重要的，因为只有它们可以被使用。

